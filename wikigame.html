<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Wikipedia Game</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Goudy+Bookletter+1911&display=swap" rel="stylesheet">
</head>
<body onload="getArticle()">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script></head>
    <script>
        var overallscore = 0;
        var fillerwords = ["the","at","there","some","my","of","be","use","her","than","and","this","an","would","first","a","have","each","make","water","to","from","which","like","been","in","or","she","him","call","is","one","do","into","who","you","had","how","time","oil","that","by","their","has","its","it","word","if","look","now","he","but","will","two","find","was","not","up","more","long","for","what","other","write","down","on","all","about","go","day","are","were","out","see","did","as","we","many","number","get","with","when","then","no","come","his","your","them","way","made","they","can","these","could","may","I","said","so","people","part"];
        function updateScore() {
            document.getElementById("score").innerHTML = "Score: ".concat(overallscore);
        }
        function shuffle(array) {
            var currentIndex = array.length,  randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                // And swap it with the current element.
                [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]];
            }

            return array;
        }
        function fourRandomNumbers(text) {
            var arr = [];
            while(arr.length < 4){
                var r = Math.floor(Math.random() * text.length-1) + 1;
                if(arr.indexOf(r) === -1) arr.push(r);
            }
            return arr;
        }
        function getArticle() {
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var page = xhttp.response;
                    var excerpt = page["extract"];
                    var indices = [];
                    document.getElementById("title").innerHTML = page["title"];
                    titlearray = page["title"].split(" ");
                    var wordarray = excerpt.split(" ");
                    numbers = fourRandomNumbers(wordarray);
                    console.log(numbers);
                    for (i = 0; i < 4; i++) {
                        var index = wordarray[numbers[i]];
                        var options = [];
                        options.push(index);
                        index = wordarray.indexOf(index);
                        if (!(titlearray.includes(wordarray[index]) || fillerwords.includes(wordarray[index]))) {
                            var tag = CryptoJS.AES.encrypt(wordarray[index], "9128756384269873465");
                            wordarray[index] = "<input type='text' list='".concat(tag).concat("' class='wordinput' style='width: ").concat((wordarray[index].length * 24).toString()).concat("px; max-width=650px;' data-tag='").concat(tag).concat("'/>");
                            excerpt = wordarray.join(" ");
                        }
                    }
                    document.getElementById("paragraph").innerHTML = excerpt;
                    document.getElementById("checkbtn").onclick = function() {check();};
                    
                }
            };
            url = "https://en.wikipedia.org/api/rest_v1/page/random/summary";
            xhttp.open("GET", url, true);
            xhttp.responseType = 'json';
            xhttp.send();
        }

        function check() {
            var inputs = document.getElementsByClassName("wordinput");
            for (i=0; i < inputs.length; i++) {
                var decryptedstr = CryptoJS.AES.decrypt(inputs[i].getAttribute("data-tag"), "9128756384269873465").toString(CryptoJS.enc.Utf8);
                if (decryptedstr === inputs[i].value) {
                    overallscore += 1;
                    console.log(overallscore);
                    inputs[i].style.borderColor = "green";
                    inputs[i].value = inputs[i].value.concat("✔️");
                    updateScore();
                    console.log(decryptedstr);
                }
                else {
                    inputs[i].style.borderColor = "red";
                    inputs[i].value = inputs[i].value.concat("❌");
                    console.log(decryptedstr);
                }
                
            }
            getArticle();
        }
    </script>
    <style>
        * {
            font-family: "Goudy Bookletter 1911", serif;
        }
        p, input {
            font-size: 20px;
        }
        p {
            line-height: 1.5;
        }
        input, input:focus {
            border-width: 0px 0px 2px 0px;
            border-color: black;
            outline: none;
            text-align: center;
        }
        input:focus {
            background-color: lightgray;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        .question {
            width: 70%;
            height: 70%;
            border: 2px solid black;
            border-radius: 10px;
            padding: 10px;
        }
    </style>
    <div class="question">
        <p id="score">Score: 0</p>
        <h1 id="title"></h1>
        <p id="paragraph"></p>
        <button onclick="check()" id="checkbtn">Submit</button>
    </div>
    
</body>
</html>
